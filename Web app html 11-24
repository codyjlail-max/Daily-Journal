<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            touch-action: none;
        }
        
        .app-container {
            min-height: 100vh;
            position: relative;
            transition: background-color 0.5s;
        }
        
        .card {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: transform 0.3s ease-out;
            touch-action: none;
        }
        
        .card.slide-from-right {
            animation: slideInFromRight 0.3s ease-out;
        }
        
        .card.slide-from-bottom {
            animation: slideInFromBottom 0.3s ease-out;
        }
        
        @keyframes slideInFromRight {
            from {
                transform: translateX(100vw);
            }
            to {
                transform: translateX(0);
            }
        }
        
        @keyframes slideInFromBottom {
            from {
                transform: translateY(100vh);
            }
            to {
                transform: translateY(0);
            }
        }
        
        .card::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.5' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
        }
        
        .card.swiping {
            transition: none;
        }
        
        .progress {
            position: absolute;
            top: 24px;
            left: 24px;
            font-size: 14px;
            z-index: 10;
            pointer-events: none;
        }
        
        .menu-btn {
            position: absolute;
            top: 24px;
            right: 24px;
            z-index: 50;
            padding: 8px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 24px;
        }
        
        .menu {
            position: absolute;
            top: 80px;
            right: 24px;
            z-index: 50;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }
        
        .menu.show {
            display: block;
        }
        
        .menu button {
            width: 100%;
            text-align: left;
            padding: 12px 16px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
        }
        
        .question-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px;
            position: relative;
            z-index: 2;
        }
        
        .question-title {
            font-size: 36px;
            font-weight: 300;
            text-align: center;
            line-height: 1.5;
            margin-bottom: 48px;
        }
        
        .down-arrow {
            width: 0;
            height: 0;
            border-left: 7px solid transparent;
            border-right: 7px solid transparent;
            border-top: 10.5px solid rgba(255,255,255,0.6);
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .bike-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            max-width: 400px;
        }
        
        .bike-btn {
            padding: 24px;
            border-radius: 12px;
            border: none;
            font-size: 24px;
            font-weight: 300;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .bike-btn:hover {
            opacity: 0.8;
        }
        
        .skip-btn {
            padding: 16px;
            font-size: 18px;
        }
        
        .answer-view {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 32px;
            padding-bottom: 20px;
            position: relative;
            z-index: 2;
            overflow-y: auto;
        }
        
        .answer-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 40px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            padding-bottom: 120px;
        }
        
        .answer-title {
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 32px;
        }
        
        .previous-answers {
            margin-bottom: 16px;
            max-height: 250px;
            overflow-y: auto;
        }
        
        .answer-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            padding: 10px 12px;
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
        }
        
        .answer-item:last-child {
            margin-bottom: 0;
        }
        
        .answer-item-text {
            flex: 1;
            color: white;
            font-size: 15px;
            line-height: 1.3;
        }
        
        .answer-item-delete {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .answer-item-delete:hover {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
        }
        
        .input-section {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            position: sticky;
            bottom: 80px;
            background: inherit;
            padding-top: 12px;
            z-index: 10;
        }
        
        .submit-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
        }
        
        .submit-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .submit-btn:active {
            transform: scale(0.95);
        }
        
        .checkboxes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 16px;
            margin-bottom: 24px;
        }
        
        .checkboxes.scrollable {
            max-height: 256px;
            overflow-y: auto;
            padding: 16px;
            border-radius: 12px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 18px;
            cursor: pointer;
            transition: opacity 0.2s, font-weight 0.2s;
            color: white;
        }
        
        .checkbox-label input {
            display: none;
        }
        
        .checkbox-label span {
            opacity: 0.6;
            font-weight: 400;
        }
        
        .checkbox-label input:checked + span {
            opacity: 1;
            font-weight: 600;
        }
        
        textarea {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            min-height: 80px;
            max-height: 150px;
            resize: vertical;
            font-family: inherit;
            color: white;
        }
        
        textarea::placeholder {
            color: rgba(255,255,255,0.5);
        }
        
        textarea:focus {
            outline: none;
        }
        
        .nav-arrows {
            position: fixed;
            bottom: 24px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 32px;
            pointer-events: none;
            z-index: 100;
        }
        
        .nav-arrow {
            width: 0;
            height: 0;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: all;
            opacity: 0.6;
        }
        
        .nav-arrow:hover {
            opacity: 0.9;
            transform: scale(1.15);
        }
        
        .arrow-left {
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 13px solid rgba(255,255,255,1);
        }
        
        .arrow-right {
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 13px solid rgba(255,255,255,1);
        }
        
        .review-view {
            min-height: 100vh;
            padding: 32px;
            overflow-y: auto;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .review-title {
            font-size: 32px;
            font-weight: 300;
        }
        
        .back-btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        
        .entry {
            max-width: 1000px;
            margin: 0 auto 16px auto;
            padding: 24px;
            border-radius: 12px;
        }
        
        .entry-date {
            font-size: 20px;
            font-weight: 300;
            margin-bottom: 16px;
        }
        
        .entry-content {
            font-size: 14px;
            line-height: 1.6;
        }
        
        .entry-question {
            font-weight: 600;
            margin-top: 12px;
            margin-bottom: 4px;
        }

        @media (max-width: 640px) {
            .question-title {
                font-size: 28px;
            }
            .answer-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Configuration
        const CONFIG = {
            dailyQuestions: [
                {
                    id: 'accomplishments',
                    title: 'What personal tasks or house projects did you accomplish today?',
                    type: 'checkboxes',
                    checkboxes: ['Grocery shopping', 'Costco run', 'Laundry', 'Mowed the lawn', 'Watered plants'],
                    textPlaceholder: 'Any other accomplishments...'
                },
                {
                    id: 'creative',
                    title: 'What creative projects did you work on today? (music, art, hobbies)',
                    type: 'text',
                    placeholder: 'Played guitar, painted, etc...'
                },
                {
                    id: 'exercise',
                    title: 'Any other exercise or big physical activities today?',
                    type: 'text',
                    placeholder: 'Hiking, swimming, yoga...'
                },
                {
                    id: 'social',
                    title: 'Who did you connect with today? (texts, calls, events)',
                    type: 'text',
                    placeholder: 'Examples: texted with Eli, went to trivia, etc.'
                },
                {
                    id: 'family',
                    title: 'Any important moments with friends or family today?',
                    type: 'text',
                    placeholder: 'Examples: played games with kids, good conversation with mom, etc.'
                },
                {
                    id: 'cooking',
                    title: 'What did you cook for dinner tonight?',
                    type: 'text',
                    placeholder: 'Pad Thai, Spaghetti Carbonara, etc...'
                },
                {
                    id: 'noteworthy',
                    title: 'Anything else noteworthy today?',
                    type: 'text',
                    placeholder: 'Examples: read a book, tried something new, etc.'
                }
            ],
            
            daySpecificQuestions: {
                workDays: [1, 2, 4, 5],
                questions: [
                    {
                        id: 'therapy_work',
                        title: 'Did you help someone or do something creative in your therapy work today?',
                        type: 'text',
                        placeholder: 'Client breakthroughs, creative interventions...'
                    },
                    {
                        id: 'beyond_appointments',
                        title: 'Did you do anything outside of your appointments today?',
                        type: 'text',
                        placeholder: 'Professional development, admin work...'
                    },
                    {
                        id: 'bike_ride',
                        title: 'Did you do your 60-minute bike ride today?',
                        type: 'bike'
                    }
                ]
            },

            colorThemes: [
                { bg: '#3d2817', inputBg: '#4d3829', text: '#ffffff', textSecondary: '#c9a882' },
                { bg: '#5a5440', inputBg: '#6b6454', text: '#ffffff', textSecondary: '#b8a894' },
                { bg: '#5c4033', inputBg: '#6b5043', text: '#ffffff', textSecondary: '#c89b7b' },
                { bg: '#7a6454', inputBg: '#8a7464', text: '#ffffff', textSecondary: '#d4c4b0' },
                { bg: '#4a4a43', inputBg: '#5a5a53', text: '#ffffff', textSecondary: '#a8a89e' },
                { bg: '#4d3829', inputBg: '#5d4839', text: '#ffffff', textSecondary: '#b89968' },
                { bg: '#6b6b5e', inputBg: '#7b7b6e', text: '#ffffff', textSecondary: '#c4c4b8' }
            ]
        };

        // App State
        let state = {
            view: 'journal',
            currentQuestionIndex: 0,
            showAnswerInput: false,
            entries: {},
            currentDate: new Date().toISOString().split('T')[0],
            menuOpen: false,
            touchStart: null,
            isSwiping: false,
            currentTextInput: '',
            slideDirection: 'right'
        };

        // Get theme for today
        function getTheme() {
            const dayOfWeek = new Date().getDay();
            return CONFIG.colorThemes[dayOfWeek];
        }

        // Get today's questions
        function getTodaysQuestions() {
            const dayOfWeek = new Date().getDay();
            const questions = [...CONFIG.dailyQuestions];
            if (CONFIG.daySpecificQuestions.workDays.includes(dayOfWeek)) {
                questions.unshift(...CONFIG.daySpecificQuestions.questions);
            }
            return questions;
        }

        // Load entries from localStorage
        function loadEntries() {
            const saved = localStorage.getItem('journalEntries');
            if (saved) {
                state.entries = JSON.parse(saved);
            }
        }

        // Save entries to localStorage
        function saveEntries() {
            localStorage.setItem('journalEntries', JSON.stringify(state.entries));
        }

        // Update entry
        function updateEntry(questionId, value) {
            if (!state.entries[state.currentDate]) {
                state.entries[state.currentDate] = { date: state.currentDate };
            }
            state.entries[state.currentDate][questionId] = value;
            saveEntries();
        }

        // Get current entry
        function getCurrentEntry() {
            return state.entries[state.currentDate] || {};
        }

        // Add answer to list
        function addAnswer(questionId) {
            const entry = getCurrentEntry();
            const currentAnswers = entry[questionId] || [];
            
            if (state.currentTextInput.trim()) {
                const newAnswers = Array.isArray(currentAnswers) ? 
                    [...currentAnswers, state.currentTextInput.trim()] : 
                    [state.currentTextInput.trim()];
                
                updateEntry(questionId, newAnswers);
                state.currentTextInput = '';
                render();
                
                // Focus the textarea after adding
                setTimeout(() => {
                    const textarea = document.getElementById(`text-input-${questionId}`);
                    if (textarea) textarea.focus();
                }, 0);
            }
        }
        
        // Handle Enter key in textarea
        function handleTextareaKeydown(e, questionId) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                addAnswer(questionId);
            }
        }

        // Delete answer from list
        function deleteAnswer(questionId, index) {
            const entry = getCurrentEntry();
            const currentAnswers = entry[questionId] || [];
            
            if (Array.isArray(currentAnswers)) {
                const newAnswers = currentAnswers.filter((_, i) => i !== index);
                updateEntry(questionId, newAnswers);
                render();
            }
        }

        // Navigation
        function goToNextQuestion() {
            const questions = getTodaysQuestions();
            if (state.currentQuestionIndex < questions.length - 1) {
                state.currentQuestionIndex++;
                state.showAnswerInput = false;
                state.currentTextInput = '';
                state.slideDirection = 'right';
                render();
            } else {
                state.view = 'review';
                render();
            }
        }

        function goToPreviousQuestion() {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                state.showAnswerInput = false;
                state.currentTextInput = '';
                state.slideDirection = 'right';
                render();
            }
        }

        function showAnswerInput() {
            state.showAnswerInput = true;
            state.slideDirection = 'bottom';
            render();
        }

        function hideAnswerInput() {
            state.showAnswerInput = false;
            state.currentTextInput = '';
            state.slideDirection = 'right';
            render();
        }

        // Touch handling
        function setupTouchHandlers() {
            const card = document.getElementById('card');
            if (!card) return;

            let touchStartX = 0;
            let touchStartY = 0;
            let touchStartTime = 0;

            card.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();
                state.isSwiping = false;
            }, { passive: true });

            card.addEventListener('touchmove', (e) => {
                if (!state.isSwiping) {
                    state.isSwiping = true;
                    card.classList.add('swiping');
                }

                const deltaX = e.touches[0].clientX - touchStartX;
                const deltaY = e.touches[0].clientY - touchStartY;

                // Apply transform based on swipe direction
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Horizontal swipe
                    card.style.transform = `translateX(${deltaX}px)`;
                } else {
                    // Vertical swipe
                    card.style.transform = `translateY(${deltaY}px)`;
                }
            }, { passive: true });

            card.addEventListener('touchend', (e) => {
                const deltaX = e.changedTouches[0].clientX - touchStartX;
                const deltaY = e.changedTouches[0].clientY - touchStartY;
                const deltaTime = Date.now() - touchStartTime;

                card.classList.remove('swiping');
                
                const swipeThreshold = 80;
                const timeThreshold = 500;

                if (deltaTime > timeThreshold) {
                    card.style.transform = '';
                    return;
                }

                const absX = Math.abs(deltaX);
                const absY = Math.abs(deltaY);

                if (absX > absY) {
                    // Horizontal swipe
                    if (absX > swipeThreshold) {
                        if (deltaX < 0) {
                            // Swipe left - next question
                            card.style.transform = 'translateX(-100vw)';
                            setTimeout(() => {
                                goToNextQuestion();
                            }, 300);
                        } else {
                            // Swipe right - previous question
                            card.style.transform = 'translateX(100vw)';
                            setTimeout(() => {
                                goToPreviousQuestion();
                            }, 300);
                        }
                    } else {
                        card.style.transform = '';
                    }
                } else {
                    // Vertical swipe
                    if (absY > swipeThreshold) {
                        if (deltaY < 0) {
                            // Swipe up - show answer
                            if (!state.showAnswerInput) {
                                card.style.transform = 'translateY(-100vh)';
                                setTimeout(() => {
                                    showAnswerInput();
                                }, 300);
                            } else {
                                card.style.transform = '';
                            }
                        } else {
                            // Swipe down - hide answer
                            if (state.showAnswerInput) {
                                card.style.transform = 'translateY(100vh)';
                                setTimeout(() => {
                                    hideAnswerInput();
                                }, 300);
                            } else {
                                card.style.transform = '';
                            }
                        }
                    } else {
                        card.style.transform = '';
                    }
                }
            }, { passive: true });
        }

        // Render functions
        function renderQuestionView() {
            const theme = getTheme();
            const questions = getTodaysQuestions();
            const question = questions[state.currentQuestionIndex];
            
            const isBike = question.type === 'bike';
            const animationClass = state.slideDirection === 'right' ? 'slide-from-right' : '';
            
            return `
                <div class="card ${animationClass}" id="card">
                    <div class="progress" style="color: ${theme.textSecondary}">
                        ${state.currentQuestionIndex + 1} of ${questions.length}
                    </div>
                    
                    <div class="question-view">
                        <div class="question-title" style="color: ${theme.text}">
                            ${question.title}
                        </div>
                        
                        ${isBike ? `
                            <div class="bike-buttons">
                                <button class="bike-btn" style="background: ${theme.inputBg}; color: ${theme.text}" 
                                        onclick="handleBikeAnswer('Easy')">Easy</button>
                                <button class="bike-btn" style="background: ${theme.inputBg}; color: ${theme.text}" 
                                        onclick="handleBikeAnswer('Medium')">Medium</button>
                                <button class="bike-btn" style="background: ${theme.inputBg}; color: ${theme.text}" 
                                        onclick="handleBikeAnswer('Hard')">Hard</button>
                                <button class="bike-btn skip-btn" style="color: ${theme.textSecondary}" 
                                        onclick="handleBikeAnswer('No')">Didn't ride today</button>
                            </div>
                        ` : `
                            <div class="down-arrow"></div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAnswerView() {
            const theme = getTheme();
            const questions = getTodaysQuestions();
            const question = questions[state.currentQuestionIndex];
            const entry = getCurrentEntry();
            
            const animationClass = state.slideDirection === 'bottom' ? 'slide-from-bottom' : 'slide-from-right';
            
            let inputHTML = '';
            
            if (question.type === 'checkboxes') {
                const checked = entry[question.id] || [];
                inputHTML = `
                    <div class="checkboxes scrollable" style="background: ${theme.inputBg}">
                        ${question.checkboxes.map(option => `
                            <label class="checkbox-label">
                                <input type="checkbox" value="${option}" 
                                    ${checked.includes(option) ? 'checked' : ''}
                                    onchange="handleCheckboxChange('${question.id}', '${option}')">
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    </div>
                    
                    ${renderTextAnswerSection(question.id + '_text', entry[question.id + '_text'], question.textPlaceholder, theme)}
                `;
            } else {
                inputHTML = renderTextAnswerSection(question.id, entry[question.id], question.placeholder, theme);
            }
            
            return `
                <div class="card ${animationClass}" id="card">
                    <div class="progress" style="color: ${theme.textSecondary}">
                        ${state.currentQuestionIndex + 1} of ${questions.length}
                    </div>
                    
                    <div class="answer-view">
                        <div class="answer-content">
                            <div class="answer-title" style="color: ${theme.text}">
                                ${question.title}
                            </div>
                            ${inputHTML}
                        </div>
                    </div>
                    
                    <div class="nav-arrows">
                        <div class="nav-arrow arrow-left" onclick="goToPreviousQuestion()" 
                             style="opacity: ${state.currentQuestionIndex > 0 ? 0.6 : 0.2}"></div>
                        <div class="nav-arrow arrow-right" onclick="goToNextQuestion()"></div>
                    </div>
                </div>
            `;
        }

        function renderTextAnswerSection(questionId, answers, placeholder, theme) {
            const answerList = Array.isArray(answers) ? answers : (answers ? [answers] : []);
            
            return `
                ${answerList.length > 0 ? `
                    <div class="previous-answers">
                        ${answerList.map((answer, index) => `
                            <div class="answer-item">
                                <div class="answer-item-text">${answer}</div>
                                <button class="answer-item-delete" onclick="deleteAnswer('${questionId}', ${index})">×</button>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                
                <div class="input-section">
                    <textarea 
                        id="text-input-${questionId}"
                        style="background: ${theme.inputBg}" 
                        placeholder="${placeholder}"
                        oninput="state.currentTextInput = this.value"
                        onkeydown="handleTextareaKeydown(event, '${questionId}')"
                    >${state.currentTextInput}</textarea>
                    <button class="submit-btn" onclick="addAnswer('${questionId}')">+</button>
                </div>
            `;
        }

        // Event handlers
        function handleBikeAnswer(answer) {
            const questions = getTodaysQuestions();
            const question = questions[state.currentQuestionIndex];
            updateEntry(question.id, answer);
            goToNextQuestion();
        }

        function handleCheckboxChange(questionId, value) {
            const entry = getCurrentEntry();
            const checked = entry[questionId] || [];
            
            if (checked.includes(value)) {
                updateEntry(questionId, checked.filter(v => v !== value));
            } else {
                updateEntry(questionId, [...checked, value]);
            }
            
            render();
        }

        function toggleMenu() {
            state.menuOpen = !state.menuOpen;
            render();
        }

        function showReview() {
            state.view = 'review';
            state.menuOpen = false;
            render();
        }

        function backToJournal() {
            state.view = 'journal';
            state.currentQuestionIndex = 0;
            state.showAnswerInput = false;
            state.currentTextInput = '';
            render();
        }

        function renderReview() {
            const theme = getTheme();
            const sortedDates = Object.keys(state.entries).sort().reverse();
            
            return `
                <div style="background: ${theme.bg}; color: ${theme.text}; min-height: 100vh">
                    <div class="review-view">
                        <div class="review-header">
                            <div class="review-title" style="color: ${theme.text}">Past Entries</div>
                            <button class="back-btn" style="background: ${theme.inputBg}; color: ${theme.text}" 
                                    onclick="backToJournal()">Back to Today</button>
                        </div>
                        ${sortedDates.map(date => {
                            const entry = state.entries[date];
                            return `
                                <div class="entry" style="background: ${theme.inputBg}">
                                    <div class="entry-date" style="color: ${theme.textSecondary}">
                                        ${new Date(date + 'T00:00:00').toLocaleDateString('en-US', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })}
                                    </div>
                                    <div class="entry-content" style="color: ${theme.text}">
                                        ${Object.keys(entry)
                                            .filter(key => key !== 'date')
                                            .map(key => {
                                                const question = [...CONFIG.dailyQuestions, ...CONFIG.daySpecificQuestions.questions]
                                                    .find(q => q.id === key || q.id + '_text' === key);
                                                if (!question) return '';
                                                
                                                const value = entry[key];
                                                if (!value || (Array.isArray(value) && value.length === 0)) return '';
                                                
                                                const displayValue = Array.isArray(value) ? 
                                                    value.map(v => `• ${v}`).join('<br>') : 
                                                    value;
                                                
                                                return `
                                                    <div class="entry-question">${question.title}</div>
                                                    <div>${displayValue}</div>
                                                `;
                                            })
                                            .filter(Boolean)
                                            .join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Main render
        function render() {
            const theme = getTheme();
            const app = document.getElementById('app');
            
            if (state.view === 'review') {
                app.innerHTML = renderReview();
                return;
            }
            
            const content = state.showAnswerInput ? renderAnswerView() : renderQuestionView();
            
            app.innerHTML = `
                <div class="app-container" style="background: ${theme.bg}">
                    <button class="menu-btn" style="background: ${theme.inputBg}; color: ${theme.text}" 
                            onclick="toggleMenu()">☰</button>
                    
                    <div class="menu ${state.menuOpen ? 'show' : ''}" 
                         style="background: ${theme.inputBg}; color: ${theme.text}">
                        <button style="color: ${theme.text}" onclick="showReview()">View Past Entries</button>
                    </div>
                    
                    ${content}
                </div>
            `;
            
            // Set up touch handlers after render
            setTimeout(setupTouchHandlers, 0);
        }

        // Initialize
        loadEntries();
        render();
    </script>
</body>
</html>
